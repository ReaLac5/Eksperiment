<!-- update_companies.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Update Company Name</title>
</head>
<body>
    <h1>Update Company Name</h1>
    <form method="post">
        {% csrf_token %}
        <label for="person_id">Select Person ID:</label>
        <select id="person_id" name="person_id">
            {% for person in people_list %}
                <option value="{{ person.id }}">{{ person.id }}</option>
            {% endfor %}
        </select>
        <br>
        <label for="new_company_name">New Company Name:</label>
        <input type="text" id="new_company_name" name="new_company_name">
        <br>
        <h2>Companies:</h2>
        <ul id="person_companies"></ul> <!-- New element to display companies -->
        <br>
        <button type="submit">Update Company Name</button>
    </form>

    <script>
        const selectPerson = document.getElementById('person_id');
        const newCompanyName = document.getElementById('new_company_name');
        const personCompaniesList = document.getElementById('person_companies');
        const peopleList = {{ people_list|safe }};
        
        selectPerson.addEventListener('change', function() {
            const selectedPersonId = this.value;
            const selectedPerson = peopleList.find(person => person.id === selectedPersonId);
            
            if (selectedPerson) {
                newCompanyName.value = ''; // Clear input field
                
                // Display companies in a list
                personCompaniesList.innerHTML = '';
                const companyIds = selectedPerson.companies;
                companyIds.forEach(companyId => {
                    const company = peopleList.find(person => person.id === companyId);
                    if (company) {
                        const li = document.createElement('li');
                        li.textContent = company.name;
                        personCompaniesList.appendChild(li);
                    }
                });
            }
        });
    </script>
</body>
</html>
